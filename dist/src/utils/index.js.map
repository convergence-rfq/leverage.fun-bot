{"version":3,"sources":["../../../src/utils/index.ts"],"sourcesContent":["import * as pdas from './pdas.js';\nimport * as programUtils from './programUtils.js';\n// import * as anchor from '@coral-xyz/anchor';\nimport axios from 'axios';\nimport Config from '../config.js';\nimport BN from 'bn.js';\nimport {\n  createAssociatedTokenAccountInstruction,\n  getAssociatedTokenAddressSync,\n} from '@solana/spl-token';\nimport {\n  Connection,\n  PublicKey,\n  Transaction,\n  sendAndConfirmTransaction,\n} from '@solana/web3.js';\n\nexport { pdas, programUtils };\n\nconst connection = new Connection(Config.TESTNET_RPC_URL, 'confirmed');\n\nexport enum OptionTypeV2 {\n  CALL = 0,\n  PUT = 1,\n  LONG_CALL_SPREAD = 2,\n  LONG_PUT_SPREAD = 3,\n}\n\nexport const sleep = (ms: number) =>\n  new Promise(resolve => setTimeout(resolve, ms));\n\nexport async function postTelegramMessage(txHash: string) {\n  const url = `https://api.telegram.org/bot${Config.TELEGRAM_BOT_TOKEN}/sendMessage`;\n  const message = `Minted call option via Leverage.fun expiring in 1 hour. Explorer: [tx link](https://eclipsescan.xyz/tx/${txHash}?cluster=testnet)`;\n\n  const payload = {\n    chat_id: Config.TELEGRAM_CHANNEL_ID,\n    text: message,\n    parse_mode: 'Markdown',\n  };\n\n  await axios.post(url, payload);\n}\nexport const serializeStrikePrices = (strikePrices: BN[]) => {\n  let buffer = Buffer.from([]);\n  strikePrices.forEach(async value => {\n    const newBuffer = value.toArrayLike(Buffer, 'le', 8);\n    // @ts-expect-error idk why this shows an error\n    buffer = Buffer.concat([buffer, newBuffer]);\n  });\n  return buffer;\n};\n\nexport async function getAtaForUser(\n  optionMint: PublicKey,\n  writerMint: PublicKey,\n  underlyingMint: PublicKey,\n  accountOwner: PublicKey,\n  allowOwnerOffCurve: boolean = false,\n) {\n  try {\n    console.log('Getting ATAs');\n\n    const optionMintAta = getAssociatedTokenAddressSync(\n      optionMint,\n      accountOwner,\n      allowOwnerOffCurve,\n    );\n    const writerMintAta = getAssociatedTokenAddressSync(\n      writerMint,\n      accountOwner,\n      allowOwnerOffCurve,\n    );\n    const underlyingMintAta = getAssociatedTokenAddressSync(\n      underlyingMint,\n      accountOwner,\n      allowOwnerOffCurve,\n    );\n\n    console.log('optionMint:', optionMint.toBase58());\n    console.log('writerMint:', writerMint.toBase58());\n    console.log('underlyingMint:', underlyingMint.toBase58());\n\n    // Validate that the provided addresses are actually token mints\n    const mintInfos = await connection.getMultipleAccountsInfo([\n      optionMint,\n      writerMint,\n      underlyingMint,\n    ]);\n\n    if (mintInfos.some(info => !info)) {\n      console.error('One or more mint addresses are invalid, trying again...');\n      await sleep(1000);\n    }\n    console.log('optionMintAta:', optionMintAta.toBase58());\n    console.log('writerMintAta:', writerMintAta.toBase58());\n    console.log('underlyingMintAta:', underlyingMintAta.toBase58());\n\n    // Check if accounts exist first\n    const accounts = await connection.getMultipleAccountsInfo([\n      optionMintAta,\n      writerMintAta,\n      underlyingMintAta,\n    ]);\n\n    const tx = new Transaction();\n\n    // Only create ATAs that don't exist\n    if (!accounts[0]) {\n      tx.add(\n        createAssociatedTokenAccountInstruction(\n          Config.ADMIN_KEYPAIR.publicKey,\n          optionMintAta,\n          accountOwner,\n          optionMint,\n        ),\n      );\n    }\n\n    if (!accounts[1]) {\n      tx.add(\n        createAssociatedTokenAccountInstruction(\n          Config.ADMIN_KEYPAIR.publicKey,\n          writerMintAta,\n          accountOwner,\n          writerMint,\n        ),\n      );\n    }\n\n    if (!accounts[2]) {\n      tx.add(\n        createAssociatedTokenAccountInstruction(\n          Config.ADMIN_KEYPAIR.publicKey,\n          underlyingMintAta,\n          accountOwner,\n          underlyingMint,\n        ),\n      );\n    }\n\n    // Only send transaction if there are instructions to execute\n    if (tx.instructions.length > 0) {\n      const sig = await sendAndConfirmTransaction(connection, tx, [\n        Config.ADMIN_KEYPAIR,\n      ]);\n      console.log('ATAs created:', sig);\n    } else {\n      console.log('All ATAs already exist');\n    }\n\n    return { optionMintAta, writerMintAta, underlyingMintAta };\n  } catch (e) {\n    console.error('Error in getAtaForUser:', e);\n    return null;\n  }\n}\n"],"names":["pdas","programUtils","axios","Config","createAssociatedTokenAccountInstruction","getAssociatedTokenAddressSync","Connection","Transaction","sendAndConfirmTransaction","connection","TESTNET_RPC_URL","OptionTypeV2","sleep","ms","Promise","resolve","setTimeout","postTelegramMessage","txHash","url","TELEGRAM_BOT_TOKEN","message","payload","chat_id","TELEGRAM_CHANNEL_ID","text","parse_mode","post","serializeStrikePrices","strikePrices","buffer","Buffer","from","forEach","value","newBuffer","toArrayLike","concat","getAtaForUser","optionMint","writerMint","underlyingMint","accountOwner","allowOwnerOffCurve","console","log","optionMintAta","writerMintAta","underlyingMintAta","toBase58","mintInfos","getMultipleAccountsInfo","some","info","error","accounts","tx","add","ADMIN_KEYPAIR","publicKey","instructions","length","sig","e"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"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"}